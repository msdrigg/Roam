# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on new Tag
"on":
    push:
        tags:
            - "v*"

jobs:
    archive_and_publish:
        name: Archive and Publish
        runs-on: macos-14
        steps:
            - uses: actions/checkout@v4
              with:
                  fetch-depth: 0
                  fetch-tags: true

            - name: Install Secret
              run: |
                  mkdir -p "./.private_keys" && \
                  echo "${{ secrets.XCODE_API_SECRET }}" > ./.private_keys/AuthKey_${{secrets.XCODE_API_KEY}}.p8

            - name: Create Secrets.xcconfig
              run: echo 'BACKEND_API_KEY = ${secrets.BACKEND_API_KEY}' > Secrets.xcconfig

            - name: Fetch Tags
              run: |
                  git fetch --tags origin && \
                  git describe --tags

            - name: Archive and Publish
              run: |
                  ./scripts/export.py --archive --publish --platform iOS macOS visionOS --github-actions
              env:
                  XCODE_API_KEY: "${{ secrets.XCODE_API_KEY }}"
                  XCODE_API_ISSUER: "${{ secrets.XCODE_API_ISSUER }}"
